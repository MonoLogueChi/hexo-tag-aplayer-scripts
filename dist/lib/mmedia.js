"use strict";var config_default_source=require("../config/config_default").config_default,config_default=require("../config/config_default").config_default,clone=function(t){return JSON.parse(JSON.stringify(t))},Config=function(){function t(t){this.hexo=t,this.root=t.config.root||"/",this.config_default=config_default,t.config.mmedia&&this._parse(clone(t.config.mmedia))}return t.prototype._parse=function(t){t.aplayer&&this.set("aplayer",t.aplayer),t.meting&&this.set("meting",t.meting),t.dplayer&&this.set("dplayer",t.dplayer),t.bilibili&&this.set("bilibili",t.bilibili)},t.prototype.get=function(t){return this.config_default[t]},t.prototype.set=function(t,e){this.config_default[t]=e},t}(),utils=require("utility");module.exports=function(t,e,n){if("meting"===e[0])return new Meting(t,e,n).generate()};var BaseConfig=function(){},BaseMmedia=function(){function t(t,e,n){this.hexo=t,this.args=e,this.mmedia_id=utils.randomString(12),this.config=new Config(t),this.tag_id="mmedia-"+this.mmedia_id}return t.prototype.generate=function(){return""},t.prototype.extractOption=function(t){var e=t.indexOf(":"),n=t.indexOf("=");if(-1!=e||-1!=n)return n<e?[t.slice(0,t.indexOf(":")),t.slice(t.indexOf(":")+1)]:[t.slice(0,t.indexOf("=")),t.slice(t.indexOf("=")+1)]},t}(),BaseTag=function(t){},__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Meting=function(i){function t(t,e,n){n=i.call(this,t,e,n)||this;return n.meting_config=new MetingConfig,n}return __extends(t,i),t.prototype.generate=function(){var e=this;return this.args.forEach(function(t){t=e.extractOption(t);t&&(e.meting_config.meting_data[t[0]]=t[1])}),new MetingTag(this.meting_config).generate()},t}(BaseMmedia),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),MetingConfig=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aplayer_css=config_default.aplayer.css,t.aplayer_js=config_default.aplayer.js,t.meting_js=config_default.meting.js,t.meting_api="",t.meting_data={},t}return __extends(t,e),t}(BaseConfig),__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),MetingTag=function(n){function t(t){var e=n.call(this,t)||this;return e.config=t,e.result="",e}return __extends(t,n),t.prototype.generate=function(){var t;this.result+='<link rel="stylesheet" href="'+this.config.aplayer_css+'">',this.result+='<script src="'+this.config.aplayer_js+'"><\/script>',this.result+='<script src="'+this.config.meting_js+'"><\/script>',""!=this.config.meting_api&&(t="var meting_api='"+this.config.meting_api+"?server=:server&type=:type&id=:id&auth=:auth&r=:r';",this.result+="<script> "+t+" <\/script>");var e,n=this.config.meting_data,i="\r\n <meting-js ";for(e in n)""!=e&&null!=e&&(i+=e+'="'+n[e]+'" ');return i+="></meting-js>",this.result+=i,this.result},t}(BaseTag);