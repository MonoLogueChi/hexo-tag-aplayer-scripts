"use strict";var clone=function(t){return JSON.parse(JSON.stringify(t))},config_default=require("../config/config_default").config_default,path=require("path"),log=require("hexo-log")({name:"hexo-tag-mmedia",debug:!1}),Config=function(){function t(t){this.hexo=t,this.root=t.config.root||"/",this.public_dir=t.config.public_dir||"public",t.config.mmedia&&this._parse(clone(t.config.mmedia)),this.copyFile()}return t.prototype.copyFile=function(){var t=path.join(this.public_dir,this.root,config_default.assets.js),e=path.join(this.public_dir,this.root,config_default.assets.css);[[path.join(path.dirname(require.resolve("dplayer")),"DPlayer.min.js"),path.join(t,"DPlayer.min.js")],[path.join(path.dirname(require.resolve("aplayer")),"APlayer.min.js"),path.join(t,"APlayer.min.js")],[path.join(path.dirname(require.resolve("aplayer")),"APlayer.min.css"),path.join(e,"APlayer.min.css")],[path.join(__dirname,"../../node_modules/meting/dist","Meting.min.js"),path.join(t,"Meting.min.js")]].forEach(function(t){fs.copyFile(t[0],t[1])})},t.prototype._parse=function(t){(config_default=utils.assign(config_default,t)).meting.js=null!==(t=config_default.meting.js)&&void 0!==t?t:config_default.assets.js+"Meting.min.js",config_default.aplayer.js=null!==(t=config_default.aplayer.js)&&void 0!==t?t:config_default.assets.js+"APlayer.min.js",config_default.aplayer.css=null!==(t=config_default.aplayer.css)&&void 0!==t?t:config_default.assets.css+"APlayer.min.css",config_default.dplayer.js=null!==(t=config_default.dplayer.js)&&void 0!==t?t:config_default.assets.js+"DPlayer.min.js"},t}(),utils=require("utility"),fs=require("hexo-fs");module.exports=function(t,e,n){switch(e[0]){case"audio":return new Audio0(t,e,n).generate();case"video":return new Video(t,e,n).generate();case"meting":return new Meting(t,e,n).generate()}};var BaseConfig=function(){},BaseMmedia=function(){function t(t,e,n){this.contents=JSON.parse("{}"),this.hexo=t,this.args=e,this.config=new Config(t),n&&(this.contents=JSON.parse(n))}return t.prototype.generate=function(){return""},t.prototype.extractOption=function(t){var e=t.indexOf(":"),n=t.indexOf("=");return n<e?[t.slice(0,t.indexOf(":")),t.slice(t.indexOf(":")+1)]:e<n?[t.slice(0,t.indexOf("=")),t.slice(t.indexOf("=")+1)]:void 0},t}(),BaseTag=function(){function t(t){this.mmedia_id=utils.randomString(12),this.tag_id="mmedia-"+this.mmedia_id}return t.prototype.parse=function(t){var e,n="";for(e in t)""!=e&&null!=e&&(t[e]?"true"===t[e]||"false"===t[e]||Number(t[e])+""!="NaN"?n+=e+"="+t[e]+" ":n+=e+'="'+t[e]+'" ':n+=e+" ");return n},t}(),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Aplayer=function(o){function t(t,e,n){n=o.call(this,t,e,n)||this;return n.aplayer_config=new AplayerConfig,n}return __extends(t,o),t.prototype.generate=function(){var e=this;return this.args.forEach(function(t){t=e.extractOption(t);t&&(e.aplayer_config.data[t[0]]=t[1])}),new AplayerTag(this.aplayer_config).generate()},t}(BaseMmedia),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),AplayerConfig=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aplayer_css=config_default.aplayer.css,t.aplayer_js=config_default.aplayer.js,t.meting_api="",t.data=config_default.aplayer.default||{},t}return __extends(t,e),t}(BaseConfig),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),AplayerTag=function(n){function t(t){var e=n.call(this,t)||this;return e.config=t,e.result="",e}return __extends(t,n),t.prototype.generate=function(){var t=this.config.data,t='<audio id="'+this.tag_id+'" '+this.parse(t)+"></audio>";return this.result+=t,this.result},t}(BaseTag),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Audio0=function(o){function t(t,e,n){n=o.call(this,t,e,n)||this;return n.audio_config=new AudioConfig,n}return __extends(t,o),t.prototype.generate=function(){var e=this;return this.args.forEach(function(t){t=e.extractOption(t);t&&(e.audio_config.data[t[0]]=t[1])}),new AudioTag(this.audio_config).generate()},t}(BaseMmedia),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),AudioConfig=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=config_default.audio.default||{},t}return __extends(t,e),t}(BaseConfig),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),AudioTag=function(n){function t(t){var e=n.call(this,t)||this;return e.config=t,e.result="",e}return __extends(t,n),t.prototype.generate=function(){var t=this.config.data,t='<audio id="'+this.tag_id+'" '+this.parse(t)+"></audio>";return this.result+=t,this.result},t}(BaseTag),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Meting=function(o){function t(t,e,n){n=o.call(this,t,e,n)||this;return n.meting_config=new MetingConfig,n}return __extends(t,o),t.prototype.generate=function(){var e=this;return this.args.forEach(function(t){t=e.extractOption(t);t&&(e.meting_config.data[t[0]]=t[1])}),new MetingTag(this.meting_config).generate()},t}(BaseMmedia),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),MetingConfig=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aplayer_css=config_default.aplayer.css,t.aplayer_js=config_default.aplayer.js,t.meting_js=config_default.meting.js,t.meting_api="",t.data=config_default.meting.default||{},t}return __extends(t,e),t}(BaseConfig),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),MetingTag=function(n){function t(t){var e=n.call(this,t)||this;return e.config=t,e.result="",e}return __extends(t,n),t.prototype.generate=function(){this.result+='<link rel="stylesheet" href="'+this.config.aplayer_css+'">',this.result+='<script src="'+this.config.aplayer_js+'"><\/script>',this.result+='<script src="'+this.config.meting_js+'"><\/script>',""!=this.config.meting_api&&(t="var meting_api='"+this.config.meting_api+"?server=:server&type=:type&id=:id&auth=:auth&r=:r';",this.result+="<script> "+t+" <\/script>");var t=this.config.data,t="<meting-js "+this.parse(t)+"></meting-js>";return this.result+=t,this.result},t}(BaseTag),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Video=function(o){function t(t,e,n){n=o.call(this,t,e,n)||this;return n.video_config=new VideoConfig,n}return __extends(t,o),t.prototype.generate=function(){var e=this;return this.args.forEach(function(t){t=e.extractOption(t);t&&(e.video_config.data[t[0]]=t[1])}),new VideoTag(this.video_config).generate()},t}(BaseMmedia),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),VideoConfig=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=config_default.video.default||{},t}return __extends(t,e),t}(BaseConfig),__extends=this&&this.__extends||function(){var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};return function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),VideoTag=function(n){function t(t){var e=n.call(this,t)||this;return e.config=t,e.result="",e}return __extends(t,n),t.prototype.generate=function(){var t=this.config.data,t='<video id="'+this.tag_id+'" '+this.parse(t)+"></video>";return this.result+=t,this.result},t}(BaseTag);